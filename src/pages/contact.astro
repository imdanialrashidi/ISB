---
import SectionTitle from "../components/SectionTitle.astro";
import WhatsAppForm from "../components/WhatsAppForm.astro";
import contactsData from "../content/contacts.json";
import BaseLayout from "../layouts/BaseLayout.astro";
import {
  compactWebsiteLabel,
  normalizePhoneForDisplay,
  toPersianDigits,
} from "../lib/locale";
import type { ContactsContent } from "../lib/types";

const contacts = contactsData as ContactsContent;
const mainPhone = contacts.phones[0];
const whatsappDigits = contacts.whatsapp.number.replace(/[^\d]/g, "");
const whatsappDisplay = toPersianDigits(normalizePhoneForDisplay(whatsappDigits));
const whatsappHref = whatsappDigits ? `https://wa.me/${whatsappDigits}` : "/contact#whatsapp";
const websiteLabel = compactWebsiteLabel(contacts.website);
const tehranOffice =
  contacts.addresses.find((address) => address.city.includes("تهران")) ?? contacts.addresses[0];
const tehranMapEmbed =
  "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d393.5300070120382!2d51.426632933969195!3d35.68956174896446!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3f8e010b34ad6e33%3A0x7ef1268ba6eed0c7!2z2b7Yp9iz2KfamCDaqdin2YjZhw!5e0!3m2!1sen!2s!4v1772093528358!5m2!1sen!2s";
---

<BaseLayout
  title="تماس با شرکت"
  description="اطلاعات تماس دفاتر شرکت ایمن صنعت باتاب، مسیرهای دسترسی و نقشه دفتر مرکزی."
  canonicalPath="/contact"
>
  <section class="section-block">
    <div class="container-wrap">
      <SectionTitle
        title="تماس با ایمن صنعت باتاب"
        subtitle="برای هماهنگی خدمات، دریافت مشاوره یا استعلام همکاری با واحد پشتیبانی شرکت در ارتباط باشید."
      />

      <div class="grid gap-6 lg:grid-cols-2">
        <article class="card p-6">
          <h2 class="text-xl font-bold text-brand-primary">اطلاعات تماس</h2>
          <ul class="mt-4 space-y-3 text-sm text-brand-text">
            {
              contacts.phones.map((phone) => (
                <li>
                  <a href={`tel:${phone.tel}`} class="font-semibold hover:text-brand-accent">
                    {phone.label}: <span class="num-text">{toPersianDigits(phone.number)}</span>
                  </a>
                </li>
              ))
            }
            <li>
              فکس: <span class="num-text">{toPersianDigits(contacts.fax)}</span>
            </li>
            <li>
              <a href={`mailto:${contacts.email}`} class="hover:text-brand-accent">
                ایمیل: <span class="latin-text">{contacts.email}</span>
              </a>
            </li>
            <li>
              <a href={contacts.website} class="hover:text-brand-accent">
                وب‌سایت: <span class="latin-text">{websiteLabel}</span>
              </a>
            </li>
            <li>
              <a
                href={whatsappHref}
                target="_blank"
                rel="noopener noreferrer"
                class="hover:text-brand-accent"
              >
                واتساپ: {whatsappDisplay}
              </a>
            </li>
          </ul>
          <p
            class="mt-4 rounded-lg border border-brand-border bg-slate-50 px-3 py-2 text-xs text-brand-muted"
          >
            {contacts.workingHours}
          </p>
          <a
            href={`tel:${mainPhone.tel}`}
            class="mt-4 inline-flex rounded-full bg-brand-accent px-5 py-2.5 text-sm font-semibold text-white hover:bg-emerald-700"
            aria-label="تماس فوری"
          >
            تماس فوری
          </a>
        </article>

        <article class="card p-6">
          <h2 class="text-xl font-bold text-brand-primary">آدرس دفاتر</h2>
          <ul class="mt-4 space-y-4 text-sm leading-7 text-brand-text">
            {
              contacts.addresses.map((address) => (
                <li class="rounded-xl border border-brand-border p-3">
                  <p class="font-semibold text-brand-primary">{address.city}</p>
                  <p class="mt-1">{address.fullAddress}</p>
                  <a
                    href={address.mapUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="mt-2 inline-flex text-xs font-semibold text-brand-accent hover:text-brand-primary"
                  >
                    مشاهده روی نقشه
                  </a>
                </li>
              ))
            }
          </ul>
        </article>
      </div>

      {tehranMapEmbed && (
        <article class="card mt-8 overflow-hidden p-2">
          <h2 class="px-4 pt-4 text-lg font-bold text-brand-primary">نقشه دفتر مرکزی تهران</h2>
          <p class="px-4 pt-2 text-sm text-brand-muted">{tehranOffice.fullAddress}</p>
          <iframe
            title="نقشه دفتر مرکزی ایمن صنعت باتاب"
            src={tehranMapEmbed}
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade"
            class="mt-4 h-[360px] w-full rounded-xl border border-brand-border"
          ></iframe>
        </article>
      )}

      <div class="mt-8">
        <WhatsAppForm whatsapp={contacts.whatsapp} />
      </div>
    </div>
  </section>
</BaseLayout>
